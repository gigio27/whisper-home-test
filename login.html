<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sign in</title>
<style>body{font-family:system-ui,Arial,sans-serif;max-width:560px;margin:40px auto;padding:0 16px}.card{border:1px solid #ddd;border-radius:12px;padding:16px}.row{margin:12px 0}button,input{padding:10px 14px;border:1px solid #ccc;border-radius:10px}input{width:100%}button{background:#fff;cursor:pointer}</style>
</head><body>
<h1>Sign in</h1>
<div class="card">
  <div class="row">
    <label>Email</label>
    <input id="email" type="email" placeholder="your@email.com" autocomplete="username"/>
    <input id="website" type="text" style="display:none"/>
  </div>
  <div class="row"><button id="req">Send verification code</button> <span id="m1"></span></div>
  <hr/>
  <div class="row"><label>Verification code</label><input id="otp" type="text" inputmode="numeric" placeholder="6-digit code"/></div>
  <div class="row"><button id="ver">Verify & continue</button> <span id="m2"></span></div>
</div>
<script>
const $=id=>document.getElementById(id);

$('req').onclick=async()=>{
  $('m1').textContent='Sending...';
  try{
    const fd=new FormData();
    fd.append('action','request_otp');
    fd.append('email',$('email').value.trim());
    fd.append('website',$('website').value);

    const r=await fetch('otp.php',{method:'POST',body:fd}); // note: sans slash initial
    const t=await r.text();
    let j; try { j=JSON.parse(t); } catch (e) { j={ error:`request failed (${r.status})` }; }
    $('m1').textContent=j.message||j.error||'Done';
    if(j.dev_hint_otp) $('m1').textContent+=` (DEV: ${j.dev_hint_otp})`;
  }catch(e){
    console.error(e);
    $('m1').textContent='Failed to send code';
  }
};

$('ver').onclick=async()=>{
  $('m2').textContent='Verifying...';
  try{
    const fd=new FormData();
    fd.append('action','verify_otp');
    fd.append('email',$('email').value.trim());
    fd.append('otp',$('otp').value.trim());
    const r=await fetch('otp.php',{method:'POST',body:fd});
    const t=await r.text();
    let j; try { j=JSON.parse(t); } catch (e) { j={ error:`verify failed (${r.status})` }; }
    if(j.token){ localStorage.setItem('token',j.token); location.href='app.html'; }
    else { $('m2').textContent=j.error||'Failed'; }
  }catch(e){
    console.error(e);
    $('m2').textContent='Verify failed';
  }
};
</script>
</body></html>
